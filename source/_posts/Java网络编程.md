---
title: Java网络编程
date: 2018-04-07 22:09:34
tags:
	- 网络编程
	- 网络协议
---

### 0x01、TCP/IP 介绍

TCP/IP 是用于因特网 (Internet) 的通信协议。

#### 计算机通信协议（Computer Communication Protocol）

计算机通信协议是对那些计算机必须遵守以便彼此通信的的规则的描述。<!--more-->

#### 什么是 TCP/IP？

TCP/IP 是供已连接因特网的计算机进行通信的通信协议。

TCP/IP 指传输控制协议/网际协议（*T*ransmission *C*ontrol *P*rotocol / *I*nternet *P*rotocol）。

TCP/IP 定义了电子设备（比如计算机）如何连入因特网，以及数据如何在它们之间传输的标准。

<!--more-->

#### 在 TCP/IP 内部

在 TCP/IP 中包含一系列用于处理数据通信的协议：

- TCP (传输控制协议) - 应用程序之间通信
- UDP (用户数据报协议) - 应用程序之间的简单通信
- IP (网际协议) - 计算机之间的通信
- ICMP (因特网消息控制协议) - 针对错误和状态
- DHCP (动态主机配置协议) - 针对动态寻址

#### TCP 使用固定的连接

TCP 用于应用程序之间的通信。

当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方"握手"之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。

这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。

UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。

#### IP 是无连接的

IP 用于计算机之间的通信。

IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。

通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。

IP 负责将每个包路由至它的目的地。

#### IP 路由器

当一个 IP 包从一台计算机被发送，它会到达一个 IP 路由器。

IP 路由器负责将这个包路由至它的目的地，直接地或者通过其他的路由器。

在一个相同的通信中，一个包所经由的路径可能会和其他的包不同。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址。

#### TCP/IP

TCP/IP 意味着 TCP 和 IP 在一起协同工作。

TCP 负责应用软件（比如您的浏览器）和网络软件之间的通信。

IP 负责计算机之间的通信。

TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。

IP 负责将包发送至接受者。



### 0x02、HTTP介绍

**HTTP协议**是**Hyper Text Transfer Protocol**（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。。

**HTTP**是一个基于**TCP/IP通信协议**来传递数据（HTML 文件, 图片文件, 查询结果等）。

**HTTP 工作原理**

HTTP协议工作于客户端-服务端架构上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。

Web服务器有：Apache服务器，IIS服务器（Internet Information Services）等。

Web服务器根据接收到的请求后，向客户端发送响应信息。

HTTP默认端口号为80，但是你也可以改为8080或者其他端口。

**HTTP三点注意事项：**

- HTTP是无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- HTTP是媒体独立的：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。
- HTTP是无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

以下图表展示了HTTP协议通信流程：

![cgiarch](https://www.runoob.com/wp-content/uploads/2013/11/cgiarch.gif)

### 0x03、TCP、UDP的介绍和区别

**TCP**是Tranfer Control Protocol的 简称，是一种面向连接的保证可靠传输的协议。

通过TCP协议传输，得到的是一个顺序的无差错的数据流。发送方和接收方的成对的两个socket之间必须建 立连接，以便在TCP协议的基础上进行通信，当一个socket（通常都是server socket）等待建立连接时，另一个socket可以要求进行连接，一旦这两个socket连接起来，它们就可以进行双向数据传输，双方都可以进行发送 或接收操作。

**UDP**是User Datagram Protocol的简称，是一种无连接的协议，每个数据报都是一个独立的信息，包括完整的源地址或目的地址，它在网络上以任何可能的路径传往目的地，因此能否到达目的地，到达目的地的时间以及内容的正确性都是不能被保证的。

**UDP和TCP的比较**

**UDP特点：**

1.每个数据报中都给出了完整的地址信息，因此无需要建立发送方和接收方的连接。

2.UDP传输数据时是有大小限制的，每个被传输的数据报必须限定在64KB之内。

3.UDP是一个不可靠的协议，发送方所发送的数据报并不一定以相同的次序到达接收方

**TCP特点：**

1.面向连接的协议，在socket之间进行数据传输之前必然要建立连接，所以在TCP中需要连接时间。

 2.TCP传输数据大小限制，一旦连接建立起来，双方的socket就可以按统一的格式传输大的数据。

 3.TCP是一个可靠的协议，它确保接收方完全正确地获取发送方所发送的全部数据。

 

### 0x04、TCP的三次握手和四次挥手

**三次握手：建立连接**

建立连接时，客户端发送syn包到到服务器，服务器收到syn包时，向客户端发送ACk 包，同时发送一个自己的syn包，客户端收到服务器的SYN+ACK包后向服务器发送ACK  这样就建立三次握手连接

```
Client: 发送sync包给Server  ---> Server: 接受client的sync包，并向Client发送ACK包和sync包  ---> Client：接受到Server的sync和ACK包，并回复ACK包
```

**四次挥手：断开连接**

断开连接可以是客户端发起，也可以是服务器端发起。假设客户端发起中断连接请求。客户端首先发送FIN报文给服务器端，表示客户端这边已完成发送数据的任务。服务器接到FIN报文后，如何此时服务器端还有数据没有发送完成，可以继续发送数据，所以服务器先发送ACK 包给客户端。 当服务气短确定数据已经发送完成，则向客户端发送FIN 报文，告诉客户端，服务器这边数据发送完了。 客户端接收到FIN报文后，就知道可以断开连接了。但是他还是不相信网络，所以发送ACK包给服务器进入TIME_WAIT状态，服务器端收到ACK后就断开连接了。 客户端在等待了一段时间后没有收到来自服务器的回复，则证明，服务器端已经正常关闭，最后客户端关闭连接        最终完成了4次挥手的断开连接

```
Client： 发送fin包   ---> Server:接受fin,先想Client发送ACK,待确定数据发送完成，向Client发送fin包
---> Client: 收到Server的fin包，不相信网络再次发送ACK给Server进入TIME_WAIT状态  ---> 服务器收到ACK,断开连接
```

